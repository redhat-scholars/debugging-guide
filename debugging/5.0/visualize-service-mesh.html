<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Blindfolded debugging&#8230;&#8203; Not today!! :: OpenShift Debugging Workshop</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/debugging/5.0/visualize-service-mesh.html">
    <link rel="prev" href="reproduce-environment.html">
    <link rel="next" href="perform-trace-analysis.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://redhat-scholars.github.io/course-template">OpenShift Debugging Workshop</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="debugging" data-version="5.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">OpenShift Debugging Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">1. Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-workspace.html">2. You are not alone</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="reproduce-environment.html">3. The past is relevant only as data</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="visualize-service-mesh.html">4. Blindfolded debugging&#8230;&#8203; Not today</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="perform-trace-analysis.html">5. Trace Within a Trace</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="live-debugging.html">6. Please Help Me!</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift Debugging Workshop</span>
    <span class="version">5.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">OpenShift Debugging Workshop</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">5.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Debugging Workshop</a></li>
    <li><a href="visualize-service-mesh.html">4. Blindfolded debugging&#8230;&#8203; Not today</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/debugging-guide/edit/5.0/documentation/modules/ROOT/pages/visualize-service-mesh.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Blindfolded debugging&#8230;&#8203; Not today!!</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>15 MINUTES PRACTICE</em></p>
</div>
<div class="paragraph">
<p>The <strong>Mysterious Application</strong> in your developer environment is now up and running. It is composed of several components, but so far, you have no clue about how the application is working.
Going all over this application and debugging it completely blindfolded is time consuming and a crazy bid.</p>
</div>
<div class="paragraph">
<p>Red Hat OpenShift Container Platform provides services to get observability of applications and to understand how different components are interacting with each other.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_kiali"><a class="anchor" href="#_what_is_kiali"></a>What is Kiali?</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="_images/kiali-logo.png" alt="Kiali" width="400">
</div>
</div>
<div class="paragraph">
<p>A Microservice Architecture breaks up the monolith into many smaller pieces that are composed together.
Patterns to secure the communication between services like fault tolerance (via timeout, retry, circuit breaking, etc.) are needed as well as distributed tracing to be able to see where calls are going.</p>
</div>
<div class="paragraph">
<p>A service mesh can now provide these services at a platform level and free the developer from those tasks.
Routing decisions are done at the mesh level.</p>
</div>
<div class="paragraph">
<p><a href="https://www.kiali.io" target="_blank" rel="noopener">Kiali</a> works with Istio, in OpenShift or Kubernetes, to visualize the service mesh topology, to
provide visibility into features like circuit breakers, request rates and more. It offers insights about the mesh components at different levels,
from abstract Applications to Services and Workloads.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kiali_please_tell_me_how_is_this_application_working"><a class="anchor" href="#_kiali_please_tell_me_how_is_this_application_working"></a>Kiali, please tell me, how is this application working?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kiali provides an interactive graph view of your namespace in real time, being able to display the interactions at several levels (applications, versions, workloads), with contextual information and charts on the selected graph node or edge.</p>
</div>
<div class="paragraph">
<p><code><strong>Click on the 'Developer Observability' button below</strong></code></p>
</div>
<div class="imageblock text-center params-link">
<div class="content">
<a class="image" href="https://kiali-istio-system.%APPS_HOSTNAME_SUFFIX%" target="_blank" rel="noopener"><img src="_images/developer-observability-button.png" alt="Developer Observability - Button" width="300"></a>
</div>
</div>
<div class="paragraph">
<p>Then, <code><strong>log in with OpenShift as user%USER_ID%/%OPENSHIFT_PASSWORD%'</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-login.png" alt="Kiali- Log In" width="300">
</div>
</div>
<div class="paragraph">
<p>In the <strong>'Graph' view</strong>, <code><strong>enter the following configuration</strong></code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Graph Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">staging-project%USER_ID%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type Graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Versioned app graph</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Traffic Animation' checked</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hide</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node = unknown OR service*=PassthroughCluster</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The outcome is a graph with all the services, connected by the requests going through them.
You can see how the services interact with each other.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-graph.png" alt="Kiali- Graph" width="900">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to get the previous screen, you need to <strong>generate traffic</strong>. <code><strong>Please reload the Web UI several times!</strong></code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Even if the application <strong>seemed</strong> working fine, <code><strong>please compare the all Services you have between the OpenShift Console and the Kiali Graph</strong></code>.</p>
</div>
<div class="paragraph">
<p><strong>Have you found the one difference?</strong> Great! Let&#8217;s investigate!</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a database missing from the Kiali Graph&#8230;&#8203;
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_check_the_catalog_service_configuration"><a class="anchor" href="#_check_the_catalog_service_configuration"></a>Check the Catalog Service Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You clearly see that the <strong>Catalog PostgreSQL Service</strong> is not a part of the Kiali graph.
That means this service is not called by the <strong>Catalog Service</strong> as it should be.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://console-openshift-console.%APPS_HOSTNAME_SUFFIX%/topology/ns/staging-project%USER_ID%/graph" class="params-link" target="_blank" rel="noopener">OpenShift Web Console</a>, from the <strong>Developer view</strong>,
<code><strong>click on 'ConfigMaps' &gt; 'catalog'</strong></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openshift-catalog-configmap.png" alt="Che - OpenShift Create Config Map" width="900">
</div>
</div>
<div class="paragraph">
<p><code><strong>Take a look at the Data Section</strong></code>. <strong>Catalog Service</strong> is configured with the development parameters.
Indeed, it is currently configured with an InMemory Database (H2), which is used for development purposes only.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openshift-catalog-configmap-h2.png" alt="OpenShift - Catalog ConfigMap H2" width="900">
</div>
</div>
<div class="paragraph">
<p>This is the reason why the <strong>Catalog PostgreSQL Service</strong> is not currently using.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fix_the_issue"><a class="anchor" href="#_fix_the_issue"></a>Fix the issue</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s change the configuration to connect the Catalog Service to the PostgreSQL database.</p>
</div>
<div class="paragraph">
<p><code><strong>Click on the tab 'YAML' of the 'CM catalog' and update the content as follows:</strong></code></p>
</div>
<div class="listingblock copypaste">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">data:
  application.properties: |
    spring.application.name=catalog
    server.port=8080

    spring.datasource.url=jdbc:postgresql://catalog-postgresql:5432/catalogdb<i class="conum" data-value="1"></i><b>(1)</b>
    spring.datasource.username=catalog
    spring.datasource.password=catalog
    spring.datasource.driver-class-name=org.postgresql.Driver<i class="conum" data-value="2"></i><b>(2)</b>
    spring.jpa.hibernate.ddl-auto=create
    spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>PostgreSQL JDBC URL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>PostgresSQL driver</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The result should look like as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/update-configmap.png" alt="OpenShift - Update Configmap" width="500">
</div>
</div>
<div class="paragraph">
<p>Then, <code><strong>click on 'Save'</strong></code>.</p>
</div>
<div class="paragraph">
<p>Now, you have to re-deploy the <strong>Catalog Service</strong> with the latest configuration.
<code><strong>Go back to 'Topology', click on the 'DC catalog-v1' bubble and select 'Start Rollout' action</strong></code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/openshift-catalog-rollout.png" alt="OpenShift - Catalog Rollout" width="900">
</div>
</div>
<div class="paragraph">
<p>Once the application is up and running, <code><strong>refresh your browser opened on the Coolstore Application
and visualize the change on the Kiali graph</strong></code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kiali-graph-with-db.png" alt="Kiali- Graph with DB" width="900">
</div>
</div>
<div class="paragraph">
<p>You survived and you put off the blindfold on your own. But it is not THE END &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s go deeper!!</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="reproduce-environment.html" class="query-params-link">3. The past is relevant only as data</a></span>
  <span class="next"><a href="perform-trace-analysis.html" class="query-params-link">5. Trace Within a Trace</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
